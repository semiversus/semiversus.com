<!DOCTYPE html><html lang=de> <head><title>Timer beim Atmel AVR</title><link rel=icon href=https://www.semiversus.com/favicon.ico><meta charset=utf-8><meta name=description content="Diese Seite beschreibt die Timer des ATMega16 Prinzipiell lässt sich diese Information auch auf andere Mikrocontroller der AVR Serie übertragen, es empfiehlt sich aber die Informationen mit dem entsprechenden Datenblatt zu vergleichen! Informationen im Datenblatt Die Informationen dieser Seite entstammen dem originalen Datenblatt (Rev. 2466T–AVR–07/10) des ..."><meta name=author content="Günther Jena"><meta name=viewport content="width=device-width, initial-scale=1.0"><meta name=google-site-verification content=O-3LVEziPiVrCYqFCwbLmB3s7lNG__cPMLLAr_RUxbA><meta name=msvalidate.01 content=70DFF0E672B42811AA384CC455C9406C><link rel=stylesheet href=https://www.semiversus.com/theme/css/semiversus.min.css?f7108c59><script async src=https://www.semiversus.com/theme/js/semiversus.min.js?c02fe949></script></head> <body data-spy=scroll data-target=#sidebar data-offset=30> <div id=wrap> <nav class="navbar navbar-inverse"> <div class=container> <div class=navbar-header> <button type=button class="navbar-toggle collapsed" data-toggle=collapse data-target=.navbar-collapse> <span class=icon-bar></span><span class=icon-bar></span><span class=icon-bar></span> </button> <a href=https://www.semiversus.com/index.html class=navbar-brand>SEMIVERSUS</a> </div> <div class="navbar-collapse collapse"> <ul class="nav navbar-nav"> <li><a href=https://www.semiversus.com/index.html>Blog</a></li> <li><a href=https://www.semiversus.com/dic/uebersicht.html>Unterricht</a></li> <li><a href=https://www.semiversus.com/projekte/projekte.html>Projekte</a></li> <li><a href=https://www.semiversus.com/about.html>Über mich</a></li> </ul> <form class="navbar-form navbar-right" role=search action=https://www.semiversus.com/search.html onsubmit="return validateForm(this.elements['q'].value);"> <input type=text class=form-control placeholder=Suche name=q id=tipue_search_input></form> <ul class="nav navbar-nav navbar-right socialicons"> <li><a href=https://www.linkedin.com/in/guenther-jena data-toggle=tooltip data-placement=bottom title=LinkedIn.com/Günther-Jena><span class="linkedin icon hidden-xs"></span><span class="hidden-sm hidden-md hidden-lg">Linkedin</span></a></li> <li><a href=https://www.xing.com/profile/Guenther_Jena2 data-toggle=tooltip data-placement=bottom title=Xing.com/Günther-Jena><span class="xing icon hidden-xs"></span><span class="hidden-sm hidden-md hidden-lg">Xing</span></a></li> <li><a href=https://stackoverflow.com/users/166605/g%C3%BCnther-jena data-toggle=tooltip data-placement=bottom title=Stackoverflow.com/Semiversus><span class="stackoverflow icon hidden-xs"></span><span class="hidden-sm hidden-md hidden-lg">Stack Overflow</span></a></li> <li><a href=https://github.com/semiversus data-toggle=tooltip data-placement=bottom title=Github.com/Semiversus><span class="github icon hidden-xs"></span><span class="hidden-sm hidden-md hidden-lg">Github</span></a></li> <li><a href=https://www.semiversus.com/semiversus.atom.xml class=rss data-toggle=tooltip data-placement=bottom title="RSS Feed"><span class="rss icon hidden-xs"></span><span class="hidden-sm hidden-md hidden-lg">RSS Feed</span></a></li> </ul> </div> </div> </nav> <div class=container> <div class=visible-print-block>Semiversus | Timer beim Atmel AVR</div> <ol class="breadcrumb hidden-print"><li><a href=https://www.semiversus.com/dic/uebersicht.html>Unterrichtsmaterial</a></li><li><a href=https://www.semiversus.com/dic/hardwarenahe_programmierung/uebersicht.html>Hardwarenahe Programmierung</a></li><li><strong>Timer beim Atmel AVR</strong></li></ol> <div class=row> <div class=col-md-8 role=main> <header><h1>Timer beim Atmel AVR<div class="pull-right hidden-print"><a href=https://www.semiversus.com/dic/hardwarenahe_programmierung/avr_timer.md class="btn btn-default btn-xs" data-toggle=tooltip data-placement=bottom title="Quelltext zu dieser Seite">Quelltext</a></div></h1></header> <div class="panel panel-info"> <div class=panel-heading>Diese Seite beschreibt die Timer des ATMega16</div> <div class=panel-body> <p>Prinzipiell l&auml;sst sich diese Information auch auf andere Mikrocontroller der AVR Serie &uuml;bertragen, es empfiehlt sich aber die Informationen mit dem entsprechenden Datenblatt zu vergleichen!</p> </div> </div> <div class="panel panel-info"> <div class=panel-heading>Informationen im Datenblatt</div> <div class=panel-body> <p>Die Informationen dieser Seite entstammen dem originalen <a class=download href=https://www.semiversus.com/dic/hardwarenahe_programmierung/atmel_atmega16.pdf>Datenblatt</a> (Rev. 2466T&ndash;AVR&ndash;07/10) des ATMega16 von Atmel.</p> </div> <div class=panel-body> <ul> <li><em>Seite 71-86</em>: Timer0 (8 Bit)<ul> <li><em>Seite 71</em>: &Uuml;bersicht und Blockschaltbild</li> <li><em>Seite 76-80</em>: Betriebsmodi</li> <li><em>Seite 83-86</em>: Registerbeschreibung</li> </ul> </li> <li><em>Seite 89-116</em>: Timer1 (16 Bit)<ul> <li><em>Seite 89</em>: &Uuml;bersicht und Blockschaltbild</li> <li><em>Seite 101-107</em>: Betriebsmodi</li> <li><em>Seite 110-116</em>: Registerbeschreibung</li> </ul> </li> <li><em>Seite 117-134</em>: Timer2 (8 Bit)<ul> <li><em>Seite 117</em>: &Uuml;bersicht und Blockschaltbild</li> <li><em>Seite 122-125</em>: Betriebsmodi</li> <li><em>Seite 128-130</em>: Registerbeschreibung</li> </ul> </li> </ul> </div> </div> <div class="panel panel-info"> <div class=panel-heading>Anwendungen</div> <div class=panel-body> <p>Je nach Anwendung liefert die folgende &Uuml;bersicht eine Hilfestellung beim Einstellen der Register:</p> </div> <div class=panel-body> <ul> <li><strong>Timer0</strong>: <a href=https://www.semiversus.com/dic/hardwarenahe_programmierung/timer0_pwm.svg>PWM</a>, <a href=https://www.semiversus.com/dic/hardwarenahe_programmierung/timer0_ctc.svg>Periodische Events</a>, <a href=https://www.semiversus.com/dic/hardwarenahe_programmierung/timer0_count.jpg>Z&auml;hlen</a></li> <li><strong>Timer1</strong>: <a href=https://www.semiversus.com/dic/hardwarenahe_programmierung/timer1_pwm.jpg>PWM</a>, <a href=https://www.semiversus.com/dic/hardwarenahe_programmierung/timer1_ctc.jpg>Periodische Events</a>, <a href=https://www.semiversus.com/dic/hardwarenahe_programmierung/timer1_count.jpg>Z&auml;hlen</a>, <a href=https://www.semiversus.com/dic/hardwarenahe_programmierung/timer1_measure.jpg>Zeiten messen</a></li> </ul> </div> </div> <h2 id=allgemeines>Allgemeines</h2> <p>Ein <em>Timer</em> ist ein spezieller Z&auml;hler, der Ereignisse z&auml;hlt. Diese Ereignisse k&ouml;nnen sich auch vom Prozessortakt ableiten und von daher kommt die Bezeichnung <em>Timer</em>. Prinzipiell ist ein Timer f&uuml;r folgende Aufgaben geeignet:</p> <ul> <li>Zeiten zwischen zwei Ereignissen messen</li> <li>Nach einer bestimmten Zeit ein Ereignis ausl&ouml;sen</li> <li>Periodische Ereignisse ausl&ouml;sen</li> <li>Ereignisse z&auml;hlen</li> <li>Erzeugung von PWM Signalen</li> </ul> <p>Diese Funktionalit&auml;ten werden in der Praxis sehr oft ben&ouml;tigt. Die universellen Einsatzm&ouml;glichkeiten haben allerdings den Nachteil, dass der Timer teilweise recht komplex in der Anwendung sein kann.</p> <p>Der ATMega16 enth&auml;lt drei Timer. Timer 0 und 2 sind 8 Bit Timer, Time 1 ist ein 16 Bit Timer.</p> <h2 id=timer-0-8-bit-timer>Timer 0 (8 Bit Timer)</h2> <p><figure><img src=https://www.semiversus.com/dic/hardwarenahe_programmierung/avr_timer0.svg><figcaption>Blockschaltbild des Timer 0 (Quelle: <a href=http://www.atmel.com/images/doc2466.pdf>Datenblatt ATMega16</a> &copy; Atmel Corporation)</figcaption></figure></p> <p>Das Blockschaltbild des Timer 0 zeigt den prinzipiellen Aufbau des Timers welcher im folgenden beschrieben wird.</p> <h3 id=interrupts>Interrupts</h3> <p>Der Timer 0 nutzt zwei Interruptquellen:</p> <ul> <li><code>TIMER0_OVF_vect</code> (im Blockschaltbild TOV0) - L&ouml;st aus, sobald es zu einem &Uuml;berlauf des Timer Registers <code>TCNT0</code> kommt</li> <li><code>TIMER0_COMP_vect</code> (im Blockschaltbild OC0) - L&ouml;st aus, sobald das Timer Register <code>TCNT0</code> gleich <code>OCR0</code> ist</li> </ul> <h3 id=tcnt0-timer-counter-register><code>TCNT0</code> - Timer Counter Register</h3> <p>Dieses Register ist der Kern des Timers. Beim Timer 0 ist dieses Register 8 Bit gro&szlig;, d.h. es kann von 0 bis 255 z&auml;hlen.</p> <p><code>TCNT0</code> kann direkt gelesen und geschrieben werden. Die Steuerung (Control Logic) hat die M&ouml;glichkeit, dieses Register auf 0 zu setzen oder das Register um eins zu erh&ouml;hen oder zu erniedrigen.</p> <p>Die Steuerung ist abh&auml;ngig von der Konfiguration &uuml;ber <code>TCCR0</code> und dem Status der Vergleiche mit 0, mit 0xFF und dem Vergleich mit <code>OCR0</code>.</p> <h3 id=ocr0-vergleichsregister><code>OCR0</code> - Vergleichsregister</h3> <p>Das Register <code>OCR0</code> ist ein 8 Bit Register das f&uuml;r den Vergleich mit <code>TCNT0</code> genutzt wird. Der Vergleich kann f&uuml;r drei Funktionen benutzt werden:</p> <ul> <li>Die Generierung eines PWM Signals mittels <em>Waveform Generetion</em> am Pin <em>OC0</em></li> <li>Das Ausl&ouml;sen des Interrupts <code>TIMER0_COMP_vect</code> bei &Auml;quvivalenz mit <code>TCNT0</code></li> <li>Die Auswertung mittels der Steuerung des Timer 0</li> </ul> <h3 id=tccr0-timer-counter-control-register><code>TCCR0</code> - Timer Counter Control Register</h3> <p>Bit|7|6|5|4|3|2|1|0 :-:!|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-: Name|FOC0|WGM00|COM01|COM00|WGM01|CS02|CS01|CS00 Read/Write|W|R/W|R/W|R/W|R/W|R/W|R/W|R/W Init|0|0|0|0|0|0|0|0</p> <h4 id=foc>FOC</h4> <p>Spezielles Bit zur Ausf&uuml;hrung eines <em>Compare Match</em> in nicht PWM Modi. F&uuml;r weitere Informationen dazu ist im Datenblatt nachzulesen.</p> <h4 id=wgm01-und-wgm00-betriebsmodi>WGM01 und WGM00 - Betriebsmodi</h4> <p>Diese beiden Bits beschreiben die Betriebsmodi des Timers:</p> <p>Modus|WGM01|WGM00|Bezeichnung -!|-|-!|- 0|0|0|Normaler Modus 1|0|1|PWM, Phasenkorrekt 2|1|0|CTC 3|1|1|Fast PWM</p> <p>Die verschiedenen Modi sind unter "<a href=#betriebsmodi_1>Betriebsmodi</a>" ausf&uuml;hrlich beschrieben.</p> <h4 id=com01-und-com00-funktion-des-oc0-pins>COM01 und COM00 - Funktion des <em>OC0</em> Pins</h4> <p>Beschreibt die Funktionsweise des Pins <em>OC0</em>. Sind beide Bits auf <code>0</code> wird der Pin als normaler Portpin verwendet (Port B Bit 3). Bei anderen Kombinationen ist der <em>Compare Match Output Mode</em> aktiv und die normale Portfunktion wird &uuml;berschrieben. Weitere Informationen finden sich unter <a href=https://www.semiversus.com/dic/hardwarenahe_programmierung/avr_pwm.html>PWM Erzeugung</a>.</p> <h4 id=cs02-cs01-und-cs00-clock-select>CS02, CS01 und CS00 - Clock Select</h4> <p>CS02|CS01|CS00|Bezeichnung -|-|-!|- 0|0|0|Kein Takt (Timer ist quasi abgeschaltet) 0|0|1|Prozessortakt 0|1|0|Prozessortakt / 8 0|1|1|Prozessortakt / 64 1|0|0|Prozessortakt / 256 1|0|1|Prozessortakt / 1024 1|1|0|Fallende Flanke an Pin T0 1|1|1|Steigende Flanke an Pin T1</p> <h3 id=timsk-timer-interrupt-mask-register_1><code>TIMSK</code> - Timer Interrupt Mask Register</h3> <p>&Uuml;ber das <em>Timer Interrupt Mask Register</em> werden die Interruptfreigaben f&uuml;r alle drei Timer gesetzt. F&uuml;r den Timer0 gibt es wie bereits beschrieben die beiden Interrupts <code>TOIE0</code> (Timer Overflow) und <code>OCIE0</code> (Output Compare Match). Um den jeweiligen Interrupt zu aktivieren muss eine logische <code>1</code> an die entsprechende Stelle geschrieben werden.</p> <p>Bit|7|6|5|4|3|2|<strong>1</strong>|<strong>0</strong> :-:!|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-: Name|OCIE2|TOIE2|TICIE1|OCIE1A|OCIE1B|TOIE1|<strong>OCIE0</strong>|<strong>TOIE0</strong> Read/Write|R/W|R/W|R/W|R/W|R/W|R/W|<strong>R/W</strong>|<strong>R/W</strong> Init|0|0|0|0|0|0|<strong>0</strong>|<strong>0</strong></p> <h2 id=betriebsmodi_1>Betriebsmodi</h2> <h3 id=normaler-modus>Normaler Modus</h3> <p>Bei diesem Modus z&auml;hlt der Timer bis zum Maximum seines Z&auml;hlbereiches (255 bzw. 65535). Der Timer kann so konfiguriert werden, dass beim Erreichen dieses Maximums der <code>TIMERn_OVF_vect</code> ausgel&ouml;st wird.</p> <p>Die Frequenz, mit der ein Overflow bei Verwendung des Prozessortakts als Taktquelle auftritt ergibt sich mit:</p> <p>%%f_{TOVF}=\frac{f_{CLK}}{Prescaler\cdot N_{max}}%%</p> <p>Als Prescaler stehen dabei 1, 8, 64, 256 und 1024 zur Verf&uuml;gung. %%N_{max}%% ist dabei 256 f&uuml;r 8 Bit Timer und 65536 f&uuml;r 16 Bit Timer.</p> <p>Der Interrupt TIMERn_COMPx_vect kann aktiviert werden und wird ausgel&ouml;st, sobald das Timerregister <code>TCNTn</code> den Vergleichswert <code>OCRn</code> erreicht.</p> <h3 id=ctc-clear-timer-on-compare>CTC - Clear Timer on Compare</h3> <p>Hier z&auml;hlt der Timer nach oben bis zum Erreichen des <code>OCRn</code> Registers. Das Register <code>TCNTn</code> wird beim Erreichen zur&uuml;ckgesetzt. Der Timer kann so konfiguriert werden, dass beim Erreichen des <code>OCRn</code> Wertes der <code>TIMERn_COMPx_vect</code> ausgel&ouml;st wird.</p> <p>Die Frequenz, mit der ein <em>Compare Match</em> bei Verwendung des Prozessortakts als Taktquelle auftritt ergibt sich mit:</p> <p>%%f_{COMP}=\frac{f_{CLK}}{Prescaler\cdot (OCRn + 1)}%%</p> <h3 id=fast-pwm>Fast PWM</h3> <p>Beim Fast PWM z&auml;hlt der Timer bis zum Maximum seines Z&auml;hlberreichs. Das Register <code>OCRn</code> dient als Vergleich und abh&auml;ngig davon, ob <code>TCNTn</code> kleiner oder gr&ouml;&szlig;er <code>OCRn</code> ist, kann der OCn Pin auf logisch <code>0</code> oder <code>1</code> gesetzt werden. Mehr dazu im Kapitel <a href=https://www.semiversus.com/dic/hardwarenahe_programmierung/avr_pwm.html>PWM Erzeugung</a>.</p> <h3 id=pwm-phasenkorrekt>PWM, Phasenkorrekt</h3> <p>Siehe auch hier im Kapitel <a href=https://www.semiversus.com/dic/hardwarenahe_programmierung/avr_pwm.html>PWM Erzeugung</a>.</p> <h2 id=pins_1>Pins</h2> <figure><img src=https://www.semiversus.com/dic/hardwarenahe_programmierung/avr_timer_pins.svg><figcaption>Pins mit Timerfunktionalit&auml;t (Quelle: <a href=http://www.atmel.com/images/doc2466.pdf>Datenblatt ATMega16</a> &copy; Atmel Corporation)</figcaption></figure> </div> <div class=col-md-4 role=complementary> <nav class="well well-sm" data-spy=affix data-offset-top=0 id=sidebar> <ul class=nav><li><a href=#allgemeines>Allgemeines</a></li><li><a href=#timer-0-8-bit-timer>Timer 0 (8 Bit Timer)</a><ul class=nav><li><a href=#interrupts>Interrupts</a></li><li><a href=#tcnt0-timer-counter-register>TCNT0 - Timer Counter Register</a></li><li><a href=#ocr0-vergleichsregister>OCR0 - Vergleichsregister</a></li><li><a href=#tccr0-timer-counter-control-register>TCCR0 - Timer Counter Control Register</a><ul class=nav><li><a href=#foc>FOC</a></li><li><a href=#wgm01-und-wgm00-betriebsmodi>WGM01 und WGM00 - Betriebsmodi</a></li><li><a href=#com01-und-com00-funktion-des-oc0-pins>COM01 und COM00 - Funktion des OC0 Pins</a></li><li><a href=#cs02-cs01-und-cs00-clock-select>CS02, CS01 und CS00 - Clock Select</a></li></ul></li><li><a href=#timsk-timer-interrupt-mask-register_1>TIMSK - Timer Interrupt Mask Register</a></li></ul></li><li><a href=#betriebsmodi_1>Betriebsmodi</a><ul class=nav><li><a href=#normaler-modus>Normaler Modus</a></li><li><a href=#ctc-clear-timer-on-compare>CTC - Clear Timer on Compare</a></li><li><a href=#fast-pwm>Fast PWM</a></li><li><a href=#pwm-phasenkorrekt>PWM, Phasenkorrekt</a></li></ul></li><li><a href=#pins_1>Pins</a></li></ul> </nav> </div> </div> </div> </div> <footer class="footer hidden-print"><div class=container><p class="text-muted credit">Günther Jena 2011 - 2020 | Letztes Update am 20.9.2020 (Rev. <a href=https://github.com/semiversus/semiversus.github.io-source/commit/ffdbb85>ffdbb85</a>) <a href=https://plus.google.com/111972313670421914746/about rel=author class=hidden>Google+</a><a href=https://creativecommons.org/licenses/by-sa/3.0/de/ class=pull-right><img src=https://www.semiversus.com/theme/img/cc_by_sa.svg alt="Licence CC-BY-SA"></a></p></div></footer> <script type=text/javascript>
        var s = document.createElement('script');
        s.type = 'text/javascript';
        s.src = 'https:' == document.location.protocol ? 'https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML' : 'http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'; 
        s[(window.opera ? "innerHTML" : "text")] =
            "MathJax.Hub.Config({" + 
            "    config: ['MMLorHTML.js']," + 
            "    jax: ['input/TeX','input/MathML','output/HTML-CSS','output/NativeMML']," +
            "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } }," + 
            "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
            "    tex2jax: { " +
            "        inlineMath: [ ['%%','%%'] ], " +
            "        processEscapes: false }, " +
            "    'HTML-CSS': { " +
            "        styles: { '.MathJax .mo, .MathJax .mi': {color: 'black ! important'}} " +
            "    } " +
            "}); ";
        (document.body || document.getElementsByTagName('head')[0]).appendChild(s);
    </script> </body> </html>